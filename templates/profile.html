<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile | Meal Planner</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #f6f5f1;
  --card: #ffffff;
  --text: #1f1f1f;
  --muted: #6c757d;
  --primary: #4B5320;
  --border: rgba(0,0,0,.08);
}

body.dark {
  --bg: #020617;
  --card: #0f172a;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --border: rgba(255,255,255,.08);
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Poppins', sans-serif;
  padding-top: 90px;
  transition: background .3s, color .3s;
}

.profile-container {
  max-width: 880px;
  margin: auto;
}

.section {
  background: var(--card);
  border-radius: 18px;
  border: 1px solid var(--border);
  padding: 24px;
  margin-bottom: 26px;
}

.section h5 {
  font-weight: 600;
  margin-bottom: 18px;
  display: flex;
  align-items: center;
  gap: 10px;
}

label {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 6px;
}

.form-control,
.form-select {
  border-radius: 12px;
  padding: 10px 14px;
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.form-control:focus,
.form-select:focus {
  background-color: transparent !important;
  color: var(--text) !important;
  border-color: var(--primary);
  box-shadow: none !important;
  outline: none;
}

.form-select option {
  background-color: var(--card);
  color: var(--text);
}

/* Fix for dark mode specifically */
body.dark .form-select option {
  background-color: #0f172a;   /* same as card */
  color: #e5e7eb;
}

.form-control:disabled {
  background: rgba(0,0,0,.05);
}

.inline-warning {
  background: rgba(245,158,11,.15);
  color: #fbbf24;
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 14px;
  margin-top: 18px;
}

.plan-pill {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  background: rgba(34,197,94,.15);
  color: #22c55e;
  font-weight: 600;
  font-size: 13px;
}

.plan-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px;
  margin-top: 14px;
}

.plan-box {
  background: rgba(0,0,0,.04);
  border-radius: 14px;
  padding: 14px;
  text-align: center;
  font-size: 14px;
}

body.dark .plan-box {
  background: rgba(255,255,255,.05);
}

.account-actions button {
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  font-weight: 600;
  margin-bottom: 12px;
}

.account-actions {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.account-actions .btn {
  padding: 12px;
  border-radius: 14px;
  font-weight: 600;
}

.btn-outline-danger {
  border-color: #ef4444;
  color: #ef4444;
}

.btn-outline-danger:hover {
  background: #ef4444;
  color: white;
}

.save-bar {
  position: sticky;
  bottom: 0;
  background: linear-gradient(to top, var(--bg), transparent);
  padding: 18px 0;
  text-align: right;
}

/* ===== MODAL DARK MODE FIX ===== */

.modal-content {
  background: var(--card);
  color: var(--text);
  border-radius: 18px;
  border: 1px solid var(--border);
}

.modal-header,
.modal-footer {
  border-color: var(--border);
}

.modal-title {
  color: var(--text);
}

.modal-body p {
  color: var(--muted);
}

.modal .form-control {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.modal .form-control::placeholder {
  color: var(--muted);
}

.modal .btn-close {
  filter: invert(1);
}

/* Light mode close button fix */
body:not(.dark) .modal .btn-close {
  filter: none;
}

</style>
</head>

<body>

{% include "navbar.html" %}

<div class="profile-container">

<form method="POST">

<!-- PERSONAL DETAILS -->
<div class="section">
  <h5>üë§ Personal Information</h5>

  <div class="row g-3">
    <div class="col-md-6">
      <label>Name</label>
      <input class="form-control" name="name" value="{{ user.name }}">
    </div>

    <div class="col-md-6">
      <label>Email</label>
      <input class="form-control" value="{{ user.email }}" disabled>
    </div>

    <div class="col-md-4">
      <label>Age</label>
      <input class="form-control" name="age" value="{{ user.age }}">
    </div>

    <div class="col-md-4">
      <label>Gender</label>
      <select class="form-select" name="gender">
        <option selected>{{ user.gender }}</option>
        <option>male</option>
        <option>female</option>
        <option>other</option>
      </select>
    </div>

    <div class="col-md-4">
      <label>Activity Level</label>
      <select class="form-select" name="activity">
        <option selected>{{ user.activity }}</option>
        <option>Sedentary</option>
        <option>Lightly Active</option>
        <option>Moderately Active</option>
        <option>Very Active</option>
      </select>
    </div>
  </div>
</div>

<!-- HEALTH PREFERENCES -->
<div class="section">
  <h5>‚ù§Ô∏è Health Preferences</h5>

  <div class="row g-3">
    <div class="col-md-3">
      <label>Height (cm)</label>
      <input class="form-control" name="height" value="{{ user.height }}">
    </div>

    <div class="col-md-3">
      <label>Weight (kg)</label>
      <input class="form-control" name="weight" value="{{ user.weight }}">
    </div>

    <div class="row g-3 mb-3">
        <div class="col-md-6">
        <label>Goal</label>
        <select class="form-select" name="goal">
            <option selected>{{ user.goal }}</option>
            <option>Lose Weight</option>
            <option>Maintain Weight</option>
            <option>Gain Weight</option>
        </select>
        </div>

        <div class="col-md-6">
        <label>Diet Type</label>
        <select class="form-select" name="diet">
            <option selected>{{ user.diet }}</option>
            <option value="veg" >Veg</option>
            <option value="non-Veg" >Non Veg</option>
            <option value="vegan" >Vegan</option>
        </select>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-md-6">
        <label>Disease</label>
        <textarea class="form-control" rows="2" name="disease">{{ user.disease }}</textarea>
        </div>

        <div class="col-md-6">
        <label>Allergies</label>
        <textarea class="form-control" rows="2" name="allergy">{{ user.allergy }}</textarea>
        </div>
    </div>
  </div>

  <div class="inline-warning">
    ‚ö†Ô∏è Changing health data will require generating a new meal plan.
  </div>
</div>

<!-- NUTRITION PLAN -->
{% if plan %}
<div class="section">
  <h5>üìä Nutrition Plan</h5>

  <span class="plan-pill">Active</span>
  <div class="mt-2 text-muted">
    {{ plan.start_date }} ‚Üí {{ plan.end_date }}
  </div>

  <div class="plan-grid">
    <div class="plan-box">{{ plan.daily_calories }} kcal</div>
    <div class="plan-box">{{ plan.daily_protein }} g protein</div>
    <div class="plan-box">{{ plan.daily_carbs }} g carbs</div>
    <div class="plan-box">{{ plan.daily_fat }} g fat</div>
  </div>
</div>
{% endif %}

<!-- ACCOUNT -->
<div class="section">
  <h5>‚öôÔ∏è Account</h5>

  <div class="account-actions">
    <a href="/change-password" class="btn btn-outline-secondary w-100"
        data-bs-toggle="modal"
        data-bs-target="#changePasswordModal">
        Change Password
    </a>

    <a href="/logout" class="btn btn-outline-danger w-100">
        Logout
    </a>

    <button type="button" class="btn btn-danger w-100"
        data-bs-toggle="modal"
        data-bs-target="#deleteAccountModal">
        Delete Account
    </button>
  </div>

</div>

<div class="save-bar">
  <button class="btn btn-success px-4">Save Changes</button>
</div>

</form>
</div>

{% include "footer.html" %}

<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form method="POST" action="/change-password" class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input type="password" name="current_password"
               class="form-control mb-3"
               placeholder="Current Password" required>

        <input type="password" name="new_password"
               class="form-control mb-3"
               placeholder="New Password" required>

        <input type="password" name="confirm_password"
               class="form-control"
               placeholder="Confirm New Password" required>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success">Update Password</button>
      </div>

    </form>
  </div>
</div>

<div class="modal fade" id="deleteAccountModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form method="POST" action="/delete-account" class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">Delete Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p class="text-danger">
          This action is permanent and cannot be undone.
        </p>

        <input type="password" name="password"
               class="form-control"
               placeholder="Enter password to confirm"
               required>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger">Delete Account</button>
      </div>

    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
