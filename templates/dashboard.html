<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard | Meal Planner</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #f6f5f1; --card: #ffffff; --text: #1f1f1f;
  --muted: #6c757d; --primary: #4B5320;
}
body.dark {
  --bg: #020617; --card: #111827;
  --text: #f1f1f1; --muted: #b5b5b5;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Poppins', sans-serif;
  padding-top: 90px;
  transition: background .4s, color .4s;
}

.navbar, .card {
  background: var(--card);
}

.text-muted { color: var(--muted)!important; }

.text-center{color: var(--text);}
/* ===== HERO ===== */
.dashboard-hero {
  background: linear-gradient(
    135deg,
    rgba(75,83,32,0.12),
    rgba(75,83,32,0.03)
  );
  border-radius: 24px;
  padding: 28px;
  margin-bottom: 32px;
}

/* ===== STATS ===== */
.stat-tile {
  background: var(--card);
  border-radius: 18px;
  padding: 18px;
  text-align: center;
  box-shadow: 0 10px 28px rgba(0,0,0,.08);
}

/* ===== DAY SELECTOR ===== */
.day-pill {
  padding: 10px 18px;
  border-radius: 22px;
  background: rgba(75,83,32,.12);
  color: var(--primary);
  font-weight: 600;
  margin-right: 10px;
  text-decoration: none;
}
.day-pill.active {
  background: var(--primary);
  color: white;
}

/* ===== MEALS ===== */
.meal-card {
  background: var(--card);
  border-radius: 20px;
  box-shadow: 0 14px 35px rgba(0,0,0,.10);
  overflow: hidden;
  transition: transform .3s;
}
.meal-card:hover { transform: translateY(-6px); }

.meal-card img {
  height: 170px;
  object-fit: cover;
}

/* ===== HEALTH TIP CARD ===== */
.health-tip-card {
  background: var(--card);
  border-radius: 18px;
  padding: 20px 22px;
  box-shadow: 0 10px 28px rgba(0,0,0,0.08);
}

.health-tip-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}

.health-tip-icon {
  background: rgba(75,83,32,0.12);
  color: var(--primary);
  font-size: 18px;
  padding: 6px 10px;
  border-radius: 10px;
}

.health-tip-title {
  font-weight: 600;
  margin: 0;
}

.health-tip-text {
  color: var(--muted);
  margin: 0;
  line-height: 1.5;
}

.review-card {
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.review-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 40px rgba(0,0,0,0.12);
}

.review-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 6px;
}

.review-icon {
  font-size: 20px;
}

.review-link {
  font-weight: 600;
  color: var(--primary);
  text-decoration: none;
}

.review-link:hover {
  text-decoration: underline;
}


</style>
</head>

<body>

{% include "navbar.html" %}

<div class="container">

<!-- HERO -->
<div class="dashboard-hero">
  <h2 class="fw-bold mb-2">
    {{ greeting }}, {{ username }} üëã
  </h2>
  {% if plan_active %}
  <p class="fw-bold text-muted mb-1">
    Progress Status: {{ progress_status }}
  </p>
  <p class="text-muted mb-2">
    Here‚Äôs your nutrition plan for today
  </p>
  {% endif %}
</div>

{% if no_plan %}
  <div class="card p-5 text-center">
    <h3>No Meal Plan Found</h3>
    <a href="/mealplan" class="btn btn-success mt-3">Create Plan</a>
  </div>
{% endif %}

{% if plan_expired %}
  <div class="card p-5 text-center">
    <h3>Your Meal Plan Has Ended</h3>
    <a href="/mealplan" class="btn btn-success">Create New Plan</a>
  </div>
{% endif %}

{% if plan_active %}

<!-- STATS -->
<div class="row g-3 mb-4">
  <div class="col-md-3"><div class="stat-tile"><small>Calories</small><h4>{{ nutrition.calories }} kcal</h4></div></div>
  <div class="col-md-3"><div class="stat-tile"><small>Protein</small><h4>{{ nutrition.protein }} g</h4></div></div>
  <div class="col-md-3"><div class="stat-tile"><small>Carbs</small><h4>{{ nutrition.carbs }} g</h4></div></div>
  <div class="col-md-3"><div class="stat-tile"><small>Fat</small><h4>{{ nutrition.fat }} g</h4></div></div>
</div>

<h4 class="fw-bold mb-2">Your Meal Plan</h4>
<p class="text-muted">Select a day</p>

<!-- DAY SELECTOR -->
<div class="d-flex mb-4 flex-wrap">
{% for day in final_meal.keys() %}
  <a href="/dashboard?day={{ day }}"
     class="day-pill {% if day == selected_day %}active{% endif %}">
     {{ day }}
  </a>
{% endfor %}
</div>

<!-- MEALS -->
<div class="row g-4">
{% for key, meal in day_meals.items() %}
  <div class="col-md-4">
    <div class="meal-card">
      <img src="{{ meal.photo }}" class="w-100">
      <div class="p-3">
        <div class="d-flex justify-content-between align-items-center">
          <span class="badge bg-success">{{ key|capitalize }}</span>
        </div>
        <h6 class="fw-bold mt-2">{{ meal.name }}</h6>
        <p class="text-muted">{{ meal.calories }} kcal</p>
        <a href="{{ meal.youtube }}" target="_blank"
           class="btn btn-sm btn-outline-success">View Recipe</a>
      </div>
    </div>
  </div>
{% endfor %}
</div>

{% endif %}

<!-- HEALTH TIP & GROCERY -->
<div class="row g-4 mt-2">

  <!-- LEFT COLUMN -->
  <div class="col-md-6 d-flex flex-column gap-4">

    <!-- HEALTH TIP -->
    <div class="health-tip-card" style="max-height: 130px;">
      <div class="health-tip-header">
        <span class="health-tip-icon">üí°</span>
        <h6 class="fw-bold health-tip-title">AI Health Tip for Today</h6>
      </div>
      <p class="health-tip-text">
        {{ health_tip }}
      </p>
    </div>

    <!-- REVIEW CARD -->
    <div class="health-tip-card review-card">
      <div class="review-header">
        <span class="review-icon">‚≠ê</span>
        <h6 class="fw-bold mb-1">Enjoying your meal plan?</h6>
      </div>
      <p class="text-muted mb-3">
        Your feedback helps us improve and build better health experiences.
      </p>
      <a href="/review" class="review-link">
        Review us ‚Üí
      </a>
    </div>

  </div>

  <!-- RIGHT COLUMN -->
  <div class="col-md-6">
    <div class="health-tip-card h-100">
      <h6 class="fw-bold mb-3">
        üõí AI Grocery List for {{ selected_day }}
      </h6>

      <pre style="
        white-space: pre-wrap;
        font-family: 'Poppins', sans-serif;
        font-size: 14px;
        background: transparent;
        border: none;
        margin: 0;
      ">{{ grocery_list }}</pre>
    </div>
  </div>

</div>

</div>

{% include "footer.html" %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
